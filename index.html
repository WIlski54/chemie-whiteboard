<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chemie Whiteboard - Kollaborativ</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <h1>ðŸ§ª Chemie Whiteboard</h1>
            <p>Kollaboratives Arbeiten in Echtzeit</p>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('create')">Raum erstellen</button>
                <button class="tab" onclick="switchTab('join')">Raum beitreten</button>
                <button class="tab" onclick="switchTab('admin')">ðŸ”’ Lehrermodus</button>
            </div>

            <div class="tab-content active" id="createTab">
                <form id="createForm">
                    <div class="form-group">
                        <label>Dein Name</label>
                        <input type="text" id="createName" placeholder="z.B. Herr MÃ¼ller" required>
                    </div>
                    <div class="form-group">
                        <label>Raum-Name</label>
                        <input type="text" id="roomName" placeholder="z.B. Chemie 10a" required>
                    </div>
                    <button type="submit" class="btn-primary">Raum erstellen</button>
                    <div class="info-box">
                        Als Lehrer erstellst du einen neuen Raum. Du erhÃ¤ltst eine Raum-ID, die du deinen SchÃ¼lern gibst.
                    </div>
                </form>
            </div>

            <div class="tab-content" id="joinTab">
                <form id="joinForm">
                    <div class="form-group">
                        <label>Dein Name</label>
                        <input type="text" id="joinName" placeholder="z.B. Max Mustermann" required>
                    </div>
                    <div class="form-group">
                        <label>Raum-ID</label>
                        <input type="text" id="roomId" placeholder="z.B. a3b8c9d2" required>
                    </div>
                    <button type="submit" class="btn-primary">Raum beitreten</button>
                    <div class="info-box">
                        Gib die Raum-ID ein, die dir dein Lehrer gegeben hat.
                    </div>
                </form>
            </div>

            <div class="tab-content" id="adminTab">
                <form id="adminForm">
                    <div class="form-group">
                        <label>Lehrer-Passwort</label>
                        <input type="password" id="adminPassword" placeholder="Passwort eingeben" required>
                    </div>
                    <button type="submit" class="btn-primary">Anmelden</button>
                    <div class="info-box">
                        Nur fÃ¼r LehrkrÃ¤fte: Hier kannst du alle RÃ¤ume verwalten, sperren oder lÃ¶schen.
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div class="app" id="adminApp" style="display: none;">
        <div class="header">
            <div class="header-left">
                <h1>ðŸ”’ Admin-Ãœbersicht</h1>
            </div>
            <div class="header-buttons">
                <button class="btn btn-white" onclick="refreshAdminData()">ðŸ”„ Aktualisieren</button>
                <button class="btn btn-red" onclick="logoutAdmin()">Abmelden</button>
            </div>
        </div>

        <div style="flex: 1; overflow-y: auto; padding: 2rem; background-color: #f9fafb;">
            <div style="max-width: 1200px; margin: 0 auto;">
                <div id="adminStats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                </div>

                <div style="background: white; border-radius: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow: hidden;">
                    <div style="padding: 1.5rem; border-bottom: 2px solid #e5e7eb;">
                        <h2 style="font-size: 1.25rem; font-weight: bold; color: #1f2937;">Aktive RÃ¤ume</h2>
                    </div>
                    <div id="adminRoomsList" style="padding: 1rem;">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Whiteboard App -->
    <div class="app" id="app">
        <div class="header">
            <div class="header-left">
                <h1>Versuchsaufbau</h1>
                <div class="room-info">
                    <div id="roomInfoDisplay"></div>
                    <div class="sync-indicator">
                        <div class="sync-dot" id="syncDot"></div>
                        <span id="syncStatus">Verbinde...</span>
                    </div>
                </div>
            </div>
            <div class="header-buttons">
                <button class="btn btn-white" onclick="showRoomInfo()">Raum-Info</button>
                <button class="btn btn-yellow" onclick="app.triggerFileInput()">Laden</button>
                <button class="btn btn-purple" id="saveBtn" onclick="app.saveSetup()">Speichern</button>
                <button class="btn btn-pink" id="pdfBtn" onclick="app.exportToPDF()">
                    <span id="pdfBtnText">PDF Export</span>
                </button>
                <button class="btn btn-green" id="connectBtn" onclick="app.startConnectionMode()">Verbinden</button>
                <button class="btn btn-red" onclick="app.showClearConfirm()">Alles lÃ¶schen</button>
            </div>
        </div>

        <input type="file" id="fileInput" accept=".json" class="hidden">

        <div class="main-content">
            <div class="canvas-area">
                <div class="canvas-container" id="canvas">
                    <svg class="canvas-svg" id="connectionsSvg"></svg>
                    <div class="items-container" id="itemsContainer"></div>
                    <div id="activityBadges"></div>
                    
                    <div id="instruction" class="instruction instruction-gray">
                        WÃ¤hle ein GerÃ¤t und tippe auf die FlÃ¤che
                    </div>
                    <div id="statusBadge" class="status-badge hidden"></div>
                </div>

                <div id="controlPanel" class="control-panel hidden">
                    <button class="control-btn control-btn-blue" onclick="app.rotateItem()">
                        Drehen
                    </button>
                    <button class="control-btn control-btn-green" onclick="app.addLabel()">
                        Beschriften
                    </button>
                    <button class="control-btn control-btn-red" onclick="app.deleteItem()">
                        LÃ¶schen
                    </button>
                </div>

                <div id="labelPanel" class="label-input-panel hidden">
                    <input type="text" id="labelInput" class="label-input" placeholder="Beschriftung eingeben...">
                    <button class="control-btn control-btn-green" onclick="app.saveLabel()">OK</button>
                    <button class="control-btn control-btn-gray" onclick="app.cancelLabel()">âœ•</button>
                </div>

                <div class="equipment-palette" id="palette"></div>
            </div>

            <div class="users-sidebar">
                <h3>
                    <span>ðŸ‘¥ Aktive Nutzer</span>
                    <span id="userCount" style="margin-left: auto; background: #2563eb; color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem;">0</span>
                </h3>
                <div id="usersList"></div>
            </div>
        </div>

        <div id="clearModal" class="modal-overlay hidden">
            <div class="modal">
                <h2>Alle GerÃ¤te lÃ¶schen?</h2>
                <p>MÃ¶chtest du wirklich alle platzierten GerÃ¤te vom Canvas entfernen?</p>
                <div class="modal-buttons">
                    <button class="btn btn-gray" onclick="app.hideClearConfirm()">Abbrechen</button>
                    <button class="btn btn-red" onclick="app.clearAll()">Ja, alles lÃ¶schen</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="app.js"></script>
</body>
</html>